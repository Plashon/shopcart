<!DOCTYPE html>
<html>
  <head>
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.16.0/dist/pdf-lib.min.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <h1 class="h1">Shopping Cart</h1>
    <div class="container">
      <div id="products">
        <div class="product">
          <img src="/product/pic1.jpg" alt="" />
          <div class="layer">
            <p class="lead">เทสโต กลิ่นปูอลาสก้า - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-name="Testo Alaskan Crab Flavor"
              data-product-id="1"
              data-price="20"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic2.jpg" alt="" />
          <div class="layer">
            <p class="lead">เบนโตะ น้ำพริกตำหรับไทย - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-name="Bento Numprik Thai Original"
              data-product-id="2"
              data-price="20"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic3.jpg" alt="" />
          <div class="layer">
            <p class="lead">คอปป อาหารเช้าซีเรียล - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="3"
              data-price="20"
              data-product-name="Copp breakfast cereal"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic4.jpg" alt="" />
          <div class="layer">
            <p class="lead">ปาปริก้า สไปซี่ ราเมง - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="4"
              data-price="20"
              data-product-name="Paprika Spicy Ramen"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic5.jpg" alt="" />
          <div class="layer">
            <p class="lead">เลย์ มันฝรั่งแท้ - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="5"
              data-price="20"
              data-product-name="Lay Original"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic6.jpg" alt="" />
          <div class="layer">
            <p class="lead">เทสโต ปลาสามรส - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="6"
              data-price="20"
              data-product-name="Testo Pla Sam Rod"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic7.jpg" alt="" />
          <div class="layer">
            <p class="lead">เลย์ เมี่ยงคำครบรส - ฿20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="7"
              data-price="20"
              data-product-name="Lay Miang Kham Krob Ros"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic8.jpg" alt="" />
          <div class="layer">
            <p class="lead">ยำยำ ต้มยำกุ้งน้ำข้น - ฿7</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="8"
              data-price="7"
              data-product-name="Yum Yum Tom Yum Shrimp Creamy"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic9.jpg" alt="" />
          <div class="layer">
            <p class="lead">ควิก ต้มยำมันกุ้ง - ฿7</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="9"
              data-price="7"
              data-product-name="Quick Tom Yam Mun Goong"
            >
              Add to Cart
            </button>
          </div>
        </div>
        <div class="product">
          <img src="/product/pic0.jpg" alt="" />
          <div class="layer">
            <p class="lead">สแน็คแจ๊ค ดั้งเดิม - $20</p>
            <button
              class="btn btn-primary"
              id="add-to-cart"
              data-product-id="10"
              data-price="20"
              data-product-name="SnackJack Original"
            >
              Add to Cart
            </button>
          </div>
        </div>
      </div>
      <div class="cart">
        <h2>Cart <i class="fa-solid fa-cart-shopping"></i></h2>
        <input
          type="text"
          id="fname"
          name="fname"
          placeholder="ชื่อ"
        /><br /><br />
        <input type="text" id="num" name="num" placeholder="เบอร์โทร" />
        <div id="cart">
          <p>No product in cart.</p>
        </div>
        <button id="place-order" class="btn btn-success">
          Place Order & Save PDF
        </button>
      </div>
    </div>
    <script>
      document
        .getElementById("place-order")
        .addEventListener("click", async () => {
          const { PDFDocument, rgb } = PDFLib;
          const pdfDoc = await PDFDocument.create();
          const page = pdfDoc.addPage([200, 250]); // smaller page size
          const { width, height } = page.getSize();

          let y = height - 50;
          // Add header "Receipt"
          page.drawText("Receipt", {
            x: 65,
            y: height - 30,
            size: 18,
            color: rgb(0, 0, 0),
          });

          y -= 10;

          // Get name and phone number from input fields
          const name = document.getElementById("fname").value;
          const phone = document.getElementById("num").value;

          // Add name and phone number to PDF
          page.drawText(`Name: ${name}`, { x: 10, y: y, size: 8, color: rgb(0, 0, 0) });
          y -= 10;
          page.drawText(`Phone: ${phone}`, { x: 10, y: y, size: 8, color: rgb(0, 0, 0) });
          y -= 10;

          // Add cart items to PDF
          for (const productName in cart) {
            const item = cart[productName];
            const itemTotalPrice = item.quantity * item.price;
            const text = `${productName}: ${item.quantity} x ${item.price} Bath = ${itemTotalPrice} Bath`;
            page.drawText(text, { x: 10, y, size: 8, color: rgb(0, 0, 0) });
            y -= 10;
          }

          // Add total price to PDF
          const totalPrice = Object.values(cart).reduce(
            (acc, item) => acc + item.quantity * item.price,
            0
          );
          const totalPriceText = `Total Price: ${totalPrice} Bath`;
          page.drawText(totalPriceText, {
            x: 20,
            y: 50,
            size: 8,
            color: rgb(0, 0, 0),
          });

          const pdfBytes = await pdfDoc.save();
          const blob = new Blob([pdfBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          // Download PDF
          const order = document.createElement("a");
          order.href = url;
          order.download = "order.pdf";
          order.click();
        });
    </script>
    <script src="save-pdf.js"></script>

    <script src="cart.js"></script>
  </body>
</html>
